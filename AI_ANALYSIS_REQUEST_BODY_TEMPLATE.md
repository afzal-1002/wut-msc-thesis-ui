# üìù AI Analysis Comment Request Body Template

## Overview

Based on your successful API test, here's the proper **Atlassian Document Format (ADF)** request body structure for creating and updating AI analysis comments in Jira.

---

## ‚úÖ Simple Example (What You Used)

```json
{
  "body": {
    "type": "doc",
    "version": 1,
    "content": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "text": "AI Analysis result here..."
          }
        ]
      }
    ]
  }
}
```

---

## üéØ AI Analysis Complete Template

### For Creating/Updating AI Analysis Comments

```json
{
  "body": {
    "type": "doc",
    "version": 1,
    "content": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "text": "[AI Analysis]",
            "marks": [
              {
                "type": "strong"
              }
            ]
          }
        ]
      },
      {
        "type": "heading",
        "attrs": {
          "level": 2
        },
        "content": [
          {
            "type": "text",
            "text": "Analysis Results"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "text": "Issue Summary: "
          },
          {
            "type": "text",
            "text": "Brief description of the issue",
            "marks": [
              {
                "type": "em"
              }
            ]
          }
        ]
      },
      {
        "type": "heading",
        "attrs": {
          "level": 3
        },
        "content": [
          {
            "type": "text",
            "text": "Root Cause"
          }
        ]
      },
      {
        "type": "bulletList",
        "content": [
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {
                    "type": "text",
                    "text": "Root cause point 1"
                  }
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {
                    "type": "text",
                    "text": "Root cause point 2"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "heading",
        "attrs": {
          "level": 3
        },
        "content": [
          {
            "type": "text",
            "text": "Recommended Solution"
          }
        ]
      },
      {
        "type": "bulletList",
        "content": [
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {
                    "type": "text",
                    "text": "Solution step 1"
                  }
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {
                    "type": "text",
                    "text": "Solution step 2"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "text": "Generated by: AI Analysis Engine | ",
            "marks": [
              {
                "type": "code"
              }
            ]
          },
          {
            "type": "text",
            "text": "Gemini"
          }
        ]
      }
    ]
  }
}
```

---

## üìã ADF Content Types Available

### 1. **Paragraph** (Text content)
```json
{
  "type": "paragraph",
  "content": [
    {
      "type": "text",
      "text": "Your text here"
    }
  ]
}
```

### 2. **Heading** (H1-H6)
```json
{
  "type": "heading",
  "attrs": {
    "level": 1
      },
  "content": [
    {
      "type": "text",
      "text": "Heading text"
    }
  ]
}
```

### 3. **Bullet List**
```json
{
  "type": "bulletList",
  "content": [
    {
      "type": "listItem",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Item 1"
            }
          ]
        }
      ]
    },
    {
      "type": "listItem",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Item 2"
            }
          ]
        }
      ]
    }
  ]
}
```

### 4. **Ordered List**
```json
{
  "type": "orderedList",
  "content": [
    {
      "type": "listItem",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "Step 1"
            }
          ]
        }
      ]
    }
  ]
}
```

### 5. **Code Block**
```json
{
  "type": "codeBlock",
  "attrs": {
    "language": "java"
  },
  "content": [
    {
      "type": "text",
      "text": "public void example() {\n  System.out.println(\"Code here\");\n}"
    }
  ]
}
```

### 6. **Block Quote**
```json
{
  "type": "blockquote",
  "content": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Quote text"
        }
      ]
    }
  ]
}
```

---

## üé® Text Formatting (Marks)

Add formatting to text using `marks`:

### **Bold**
```json
{
  "type": "text",
  "text": "Bold text",
  "marks": [{"type": "strong"}]
}
```

### **Italic**
```json
{
  "type": "text",
  "text": "Italic text",
  "marks": [{"type": "em"}]
}
```

### **Strikethrough**
```json
{
  "type": "text",
  "text": "Strikethrough text",
  "marks": [{"type": "strike"}]
}
```

### **Code (Inline)**
```json
{
  "type": "text",
  "text": "variable",
  "marks": [{"type": "code"}]
}
```

### **Link**
```json
{
  "type": "text",
  "text": "Click here",
  "marks": [
    {
      "type": "link",
      "attrs": {
        "href": "https://example.com"
      }
    }
  ]
}
```

### **Multiple Marks**
```json
{
  "type": "text",
  "text": "Bold and italic",
  "marks": [
    {"type": "strong"},
    {"type": "em"}
  ]
}
```

---

## üöÄ AI Analysis Request Body Format

### Recommended Structure for AI Analysis

```json
{
  "body": {
    "type": "doc",
    "version": 1,
    "content": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "text": "ü§ñ AI Analysis ",
            "marks": [{"type": "strong"}]
          },
          {
            "type": "text",
            "text": "| Model: Gemini"
          }
        ]
      },
      {
        "type": "heading",
        "attrs": {"level": 2},
        "content": [
          {"type": "text", "text": "Issue Analysis"}
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {"type": "text", "text": "Brief description of the issue"}
        ]
      },
      {
        "type": "heading",
        "attrs": {"level": 3},
        "content": [
          {"type": "text", "text": "Root Causes"}
        ]
      },
      {
        "type": "bulletList",
        "content": [
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "First root cause"}
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Second root cause"}
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "heading",
        "attrs": {"level": 3},
        "content": [
          {"type": "text", "text": "Recommendations"}
        ]
      },
      {
        "type": "orderedList",
        "content": [
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Fix step 1"}
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Fix step 2"}
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}
```

---

## ‚úÖ Current Frontend Implementation

Your frontend already uses this format! In `ai-analysis-page.component.ts`:

```typescript
const request: JiraCommentUpdateRequest = {
  body: {
    type: 'doc',
    version: 1,
    content  // Built from buildAtlassianContentFromTexts()
  },
  visibility: {
    type: 'role',
    value: this.visibilityRole
  }
};
```

The `buildAtlassianContentFromTexts()` method automatically converts markdown to ADF format:
- `# Heading` ‚Üí ADF heading
- `- bullet point` ‚Üí ADF bullet list
- `**bold**` ‚Üí ADF strong mark
- `*italic*` ‚Üí ADF em mark

---

## üì§ Full Request Example for API Testing

### POST /api/wut/jira/comment/ISSUE-123

```json
{
  "body": {
    "type": "doc",
    "version": 1,
    "content": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "text": "[AI Analysis]",
            "marks": [{"type": "strong"}]
          }
        ]
      },
      {
        "type": "heading",
        "attrs": {"level": 2},
        "content": [
          {"type": "text", "text": "Issue Summary"}
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {"type": "text", "text": "Database connection timeout when executing queries over 30 seconds"}
        ]
      },
      {
        "type": "heading",
        "attrs": {"level": 3},
        "content": [
          {"type": "text", "text": "Root Causes"}
        ]
      },
      {
        "type": "bulletList",
        "content": [
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Connection pool exhaustion"}
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Missing database indexes"}
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Inefficient query execution"}
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "heading",
        "attrs": {"level": 3},
        "content": [
          {"type": "text", "text": "Recommended Fixes"}
        ]
      },
      {
        "type": "orderedList",
        "content": [
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Increase database connection pool size"},
                  {"type": "text", "text": " from 10 to 25"}
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Add indexes on frequently queried columns"}
                ]
              }
            ]
          },
          {
            "type": "listItem",
            "content": [
              {
                "type": "paragraph",
                "content": [
                  {"type": "text", "text": "Optimize slow queries using EXPLAIN PLAN"}
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}
```

---

## üîÑ Update vs Create

Both **POST** and **PUT** use the same body format:

```json
// POST /api/wut/jira/comment/ISSUE-123 (CREATE)
// PUT /api/wut/jira/comment/ISSUE-123/commentId (UPDATE)

{
  "body": {
    "type": "doc",
    "version": 1,
    "content": [
      // ... your ADF content
    ]
  }
}
```

---

## ‚ú® Best Practices

‚úÖ **Do:**
- Use appropriate heading levels (h1 at top)
- Use bullet lists for multiple points
- Use ordered lists for steps
- Use bold for important terms
- Use code marks for technical terms
- Keep paragraphs concise

‚ùå **Don't:**
- Use empty content arrays
- Mix incompatible content types
- Use invalid heading levels (7+)
- Leave required fields empty

---

## üìä Content Type Reference

| Type | Use For | Notes |
|------|---------|-------|
| `paragraph` | Regular text | Default, most common |
| `heading` | Titles | Levels 1-6 |
| `bulletList` | Unordered points | With `listItem` children |
| `orderedList` | Numbered steps | With `listItem` children |
| `codeBlock` | Code snippets | Use `language` attr |
| `blockquote` | Quoted text | Important notes |

---

## üéØ Summary

Your frontend is already building **proper ADF format** automatically from markdown. When updating AI analysis:

1. ‚úÖ Markdown converts to ADF
2. ‚úÖ Request body structure is correct
3. ‚úÖ Version is 1
4. ‚úÖ Type is "doc"
5. ‚úÖ Content array is properly formatted

**Everything is ready!** Just make sure your backend checks for existing comments before creating duplicates. üöÄ
