<!-- PROJECTS HOME PAGE -->
<div class="projects-container">
  <!-- Header Section -->
  <div class="projects-header">
    <div class="header-content">
      <h2 class="page-title">Projects</h2>
      <p class="page-subtitle">Manage your projects</p>
    </div>
    <button class="btn btn-primary btn-lg" routerLink="/create-project">
      <span class="btn-icon">+</span> Create New Project
    </button>
  </div>

  <!-- Project Source Toggle -->
  <div class="project-source-toggle">
    <div class="toggle-buttons">
      <button class="toggle-btn" 
              [class.active]="projectSource === 'jira'"
              (click)="toggleProjectSource('jira')">
        <span class="toggle-icon">‚òÅÔ∏è</span>
        Jira Projects
      </button>
      <button class="toggle-btn" 
              [class.active]="projectSource === 'local'"
              (click)="toggleProjectSource('local')">
        <span class="toggle-icon">üíæ</span>
        Local Projects
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading projects...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Error:</strong> {{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && projects.length === 0 && !errorMessage" class="empty-state">
    <div class="empty-state-icon">üìÅ</div>
    <h4>No Projects Found</h4>
    <p>You don't have any projects yet. Create one to get started.</p>
    <button class="btn btn-primary" routerLink="/create-project">
      Create Your First Project
    </button>
  </div>

  <!-- Projects Grid -->
  <div *ngIf="!isLoading && projects.length > 0" class="projects-grid">
    <div *ngFor="let project of projects" class="project-card">
      <!-- Project Card Header -->
      <div class="project-card-header">
        <div class="project-info">
          <h5 class="project-key">{{ project.key }}</h5>
          <h4 class="project-name">{{ project.name }}</h4>
        </div>
        <div class="project-type-badge">
          <span class="badge" [ngClass]="project.projectTypeKey === 'software' ? 'bg-primary' : 'bg-info'">
            {{ project.projectTypeKey }}
          </span>
        </div>
      </div>

      <!-- Project Card Body -->
      <div class="project-card-body">
        <!-- Description -->
        <p class="project-description" *ngIf="project.description">
          {{ project.description }}
        </p>
        <p class="project-description text-muted" *ngIf="!project.description">
          No description provided
        </p>

        <!-- Lead Information -->
        <div class="project-lead-section" *ngIf="project.lead">
          <div class="lead-info">
            <small class="detail-label">Project Lead:</small>
            <div class="lead-details">
              <img *ngIf="project.lead.avatarUrls?.['24x24']" 
                   [src]="project.lead.avatarUrls['24x24']" 
                   [alt]="project.lead.displayName" 
                   class="lead-avatar" />
              <span class="lead-name">{{ project.lead.displayName }}</span>
              <span class="lead-account-id" [title]="project.lead.accountId">({{ project.lead.accountId | slice:0:15 }}...)</span>
            </div>
          </div>
        </div>

        <!-- Project Details Grid -->
        <div class="project-details-grid">
          <div class="detail-item">
            <small class="detail-label">Project ID:</small>
            <span class="detail-value" [title]="project.id">{{ project.id }}</span>
          </div>
          <div class="detail-item">
            <small class="detail-label">Assignee Type:</small>
            <span class="detail-value">{{ project.assigneeType }}</span>
          </div>
          <div class="detail-item">
            <small class="detail-label">Issue Types:</small>
            <span class="detail-value">{{ project.issueTypes?.length || 0 }} types</span>
          </div>
          <div class="detail-item">
            <small class="detail-label">Style:</small>
            <span class="detail-value">{{ project.style }}</span>
          </div>
          <div class="detail-item">
            <small class="detail-label">Visibility:</small>
            <span class="detail-value" [ngClass]="project.private ? 'text-danger' : 'text-success'">
              {{ project.private ? 'Private' : 'Public' }}
            </span>
          </div>
        </div>

        <!-- Issue Types -->
        <div class="issue-types-section" *ngIf="project.issueTypes && project.issueTypes.length > 0">
          <small class="detail-label">Supported Issue Types:</small>
          <div class="issue-types-list">
            <span *ngFor="let issueType of project.issueTypes" class="issue-type-badge">
              <img *ngIf="issueType.iconUrl" 
                   [src]="issueType.iconUrl" 
                   [alt]="issueType.name" 
                   class="issue-type-icon" 
                   title="{{ issueType.description }}" />
              {{ issueType.name }}
            </span>
          </div>
        </div>
      </div>

      <!-- Project Card Footer -->
      <div class="project-card-footer">
        <button class="btn btn-sm btn-primary" (click)="viewProjectDetails(project)">
          üîç View Details
        </button>
        <button class="btn btn-sm btn-info" (click)="viewBugs(project.key)">
          üêõ View Bugs
        </button>
        <button class="btn btn-sm btn-warning" (click)="editProject(project)">
          ‚úèÔ∏è Edit
        </button>
        <button class="btn btn-sm btn-danger" (click)="toggleDeleteConfirmation(project.key)">
          üóëÔ∏è Delete
        </button>
      </div>

      <!-- Delete Confirmation Modal -->
      <div *ngIf="deleteConfirmationProjectId === project.key" class="delete-confirmation">
        <div class="delete-confirmation-content">
          <h6>Delete Project?</h6>
          <p>Are you sure you want to delete <strong>{{ project.key }} - {{ project.name }}</strong>? This action cannot be undone.</p>
          <div class="confirmation-buttons">
            <button class="btn btn-sm btn-danger" (click)="deleteProject(project.key)">
              Yes, Delete
            </button>
            <button class="btn btn-sm btn-secondary" (click)="cancelDelete()">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="back-button-container mt-4">
    <button class="btn btn-secondary" routerLink="/home">
      ‚Üê Back to Home
    </button>
  </div>
</div>
